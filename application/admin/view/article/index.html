{extend name="app" /}
{block name="title"}{/block}
{block name="content"}
    <div class="row">
        <div class="col-md-12">
            <div class="widget widget-default">
                <div class="widget-header">
                    <h6><i class="fa fa-sticky-note fa-fw"></i>文章</h6>
                </div>
                <div class="widget-body">
                    <table class="table table-hover table-bordered table-responsive">
                        <thead>
                        <tr>
                            <th>标题</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {foreach $articles['data'] as $article}
                            {if condition="$article.status ==1"}
                                <tr class="success">
                            {else/}
                                <tr class="danger">
                            {/if}

                                <td>{$article.title}</td>
                                <td>
                                    {if condition="$article.status ==1"}
                                    <span class="label label-sm label-primary"> 已发表 </span>
                                    {else/}
                                    <span class="label label-sm label-danger"> 已禁用 </span>
                                    {/if}
                                </td>
                                <td>
                                    <div>
                                        <a href="{{ $post->trashed()?'javascript:void(0)':route('post.edit',$post->id) }}"
                                           data-toggle="tooltip" data-placement="top" title="编辑"
                                           class="btn btn-info">
                                            <i class="fa fa-pencil fa-fw"></i>
                                        </a>

                                        <button type="submit" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="恢复">
                                            <i class="fa fa-repeat fa-fw"></i>
                                        </button>


                                        <a href="{{ route('post.show',$post->slug) }}"
                                           data-toggle="tooltip" data-placement="top" title="查看"
                                           class="btn btn-success">
                                            <i class="fa fa-eye fa-fw"></i>
                                        </a>

                                        <button type="submit" class="btn btn-warning" data-toggle="tooltip" data-placement="top" title="撤销发布">
                                            <i class="fa fa-undo fa-fw"></i>
                                        </button>

                                        <a href="{{ route('post.preview',$post->slug) }}"  data-toggle="tooltip" data-placement="top" title="预览"
                                           class="btn btn-default">
                                            <i class="fa fa-eye fa-fw"></i>
                                        </a>
                                        <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="发布">
                                            <i class="fa fa-send-o fa-fw"></i>
                                        </button>

                                        <button class="btn btn-danger" data-toggle="modal" data-title="{{ $post->title }}"
                                                data-toggle="tooltip" data-placement="top" title="删除"
                                                data-url="{{ route('post.destroy',$post->id) }}"
                                                data-force="{{ $post->trashed() }}"
                                                data-target="#delete-post-modal">
                                            <i class="fa fa-trash-o  fa-fw"></i>
                                        </button>
                                        <a class="btn btn-default" href="{{ route('post.download',$post->id) }}">
                                            <i class="fa fa-cloud-download fa-fw"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        {/foreach}
                        </tbody>
                    </table>
                    {if condition="$articles.last_page > 1"}
                    {$page}
                    {/if}
                </div>
            </div>
        </div>
    </div>
<!--modal-->
    <div class="modal fade" id="delete-post-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">删除</h4>
                </div>
                <div class="modal-body">
                    确定删除<span id="span-title"></span>吗?
                </div>
                <div class="modal-footer">
                    <form id="delete-form" method="post">

                        <input type="hidden" name="_method" value="DELETE">
                        <input type="hidden" name="redirect" value="/admin/posts">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button id="confirm-btn" type="submit" class="btn btn-primary">确定</button>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
{/block}

{block name="script"}
    <script>
        $('#delete-post-modal').on('show.bs.modal', function (e) {
            var url = $(e.relatedTarget).data('url');
            var title = $(e.relatedTarget).data('title');
            var force = $(e.relatedTarget).data('force');
            var confirm_btn_text = force == '1' ? '确定(这将永久刪除)' : '删除';
            var confirm_btn_type = force == '1' ? 'btn btn-danger' : 'btn btn-primary';
            $('#confirm-btn').text(confirm_btn_text);
            $('#confirm-btn').attr('class', confirm_btn_type);
            $('#span-title').text(title);
            $('#delete-form').attr('action', url);
        });
    </script>
{/block}
